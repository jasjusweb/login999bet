if(typeof QRCode==='undefined'){let s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js';document.head.appendChild(s)}
if(typeof jQuery!=='undefined'){
let l=document.createElement('link');
l.rel='stylesheet';
l.href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css';
document.head.appendChild(l);
}
function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}
function parseQrisMerchantName(q){const t='59';const i=q.indexOf(t);if(i===-1)return null;const l=i+t.length;const n=q.substring(l,l+2);const a=parseInt(n,10);if(isNaN(a))return null;const s=l+2;return q.substring(s,s+a)}
function generateQrisPayload(o,a){function c(d){let c=0xFFFF;for(let b=0;b<d.length;b++){c^=d.charCodeAt(b)<<8;for(let e=0;e<8;e++)c=(c&0x8000)?(c<<1)^0x1021:c<<1}
return('0000'+(c&0xFFFF).toString(16).toUpperCase()).slice(-4)}
const t='5802ID';const i=o.indexOf(t);if(i===-1)throw new Error("Format qrisString tidak valid.");const p=o.substring(0,i);const s=o.substring(i);const m=a.toString();const l=m.length.toString().padStart(2,'0');const n=`54${l}${m}`;const r=`${p}${n}${s}6304`;const u=c(r);return `${p}${n}${s}6304${u}`}
jQuery(document).ready(function($){if($('.qris-cepat-wrapper-v11').length>0){return}
let qT=null;let bC=null;let pIR=null;let accountData=null;function compressImage(file,maxSizeInMB=1){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.readAsDataURL(file);reader.onload=(event)=>{const img=new Image();img.src=event.target.result;img.onload=()=>{const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');const MAX_WIDTH=1920;const MAX_HEIGHT=1080;let width=img.width;let height=img.height;if(width>height){if(width>MAX_WIDTH){height*=MAX_WIDTH/width;width=MAX_WIDTH}}else{if(height>MAX_HEIGHT){width*=MAX_HEIGHT/height;height=MAX_HEIGHT}}
canvas.width=width;canvas.height=height;ctx.drawImage(img,0,0,width,height);canvas.toBlob((blob)=>{if(blob.size<file.size){resolve(blob)}else{resolve(file)}},'image/jpeg',0.7)};img.onerror=(error)=>reject(error)};reader.onerror=(error)=>reject(error)})}
const cS=`
.qris-cepat-wrapper-v11,.qris-cepat-wrapper-v11 *{box-sizing:border-box}.qris-cepat-wrapper-v11 .cepat-form-container{display:none;background-color:#212121;border-radius:12px;box-shadow:0 2px 8px rgb(0 0 0 / .2);border:1px solid #444}.qris-cepat-wrapper-v11 .depo-tabs{display:flex;gap:8px;margin-bottom:20px;background-color:#1c1c1c;padding:5px;border-radius:12px;border:1px solid #444}.qris-cepat-wrapper-v11 .tab{flex:1;padding:8px 10px;cursor:pointer;color:#fff;font-weight:600;text-align:center;border-radius:8px;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:6px;font-size:.85rem;border:none;background-color:#424242;position:relative;overflow:visible}.qris-cepat-wrapper-v11 .tab.active{background-color:#FDB813;color:#000;box-shadow:0 0 15px rgb(253 184 19 / .7)}.qris-cepat-wrapper-v11 .tab[data-target="ewallet"].active{background-color:#FDB813;box-shadow:0 0 15px rgb(253 184 19 / .7)}.qris-cepat-wrapper-v11 .tab img{height:16px;filter:brightness(0) invert(1)}.qris-cepat-wrapper-v11 .tab[data-target="qris"]::after{content:'CEPAT';position:absolute;top:-6px;right:-5px;background-color:#ff4757;color:#fff;padding:2px 5px;border-radius:5px;font-size:.6rem;font-weight:700;animation:blink-animation 1.2s infinite ease-in-out;z-index:1}.qris-cepat-wrapper-v11 .tab[data-target="ewallet"]::after{content:'MANUAL';position:absolute;top:-6px;right:-5px;background-color:#ff4757;color:#fff;padding:2px 5px;border-radius:5px;font-size:.6rem;font-weight:700;animation:blink-animation 1.2s infinite ease-in-out;z-index:1}.qris-cepat-wrapper-v11 .form-group{margin-bottom:20px}.qris-cepat-wrapper-v11 label{display:block;font-weight:600;margin-bottom:.75rem;color:#BDBDBD;text-transform:none;font-size:.9rem}.qris-cepat-wrapper-v11 .form-control{height:46px!important;width:100%;padding:.8rem 1rem;font-size:1rem;color:#FFF;background-color:#333;border:1px solid #555;border-radius:12px;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control:disabled{background-color:#2a2a2a;opacity:.7}.form-control.is-invalid{border-color:#d9534f!important;animation:shake .6s}.qris-validation-message{align-items:center;gap:8px;padding:10px 12px;background-color:#442020;border:1px solid #e57373;border-radius:8px;color:#ffcdd2;font-size:.875rem;font-weight:500;margin-top:10px;display:none}.qris-validation-message::before{font-family:"Font Awesome 6 Free";content:"\\f071";font-weight:900;display:inline-block;margin-right:8px}.payment-method-box{background-color:#333;border-radius:12px;padding:20px 15px;text-align:center;margin-bottom:20px;box-shadow:0 1px 5px rgb(0 0 0 / .3)}.payment-method-box img,.payment-method-box svg{display:inline-block;margin:0 auto;max-height:70px;width:auto;max-width:180px;opacity:.9;transition:opacity .3s ease}.payment-method-box svg{fill:#FDB813}.payment-method-box:hover img,.payment-method-box:hover svg{opacity:1}.quick-amount-selector{display:flex;flex-wrap:nowrap;overflow-x:auto;gap:10px;padding-bottom:10px;scrollbar-width:thin;scrollbar-color:#FDB813 #424242}.quick-amount-btn{flex-shrink:0;padding:10px 15px;background-color:#424242;border:2px solid #555;color:#E0E0E0;border-radius:12px;cursor:pointer;transition:all .2s ease;text-align:center;font-weight:600;font-size:.85rem}.quick-amount-btn.active{border-color:#FDB813;background-color:#333;color:#FDB813;box-shadow:0 0 0 3px rgb(253 184 19 / .25)}.input-group-promo{display:flex;align-items:stretch;position:relative}.input-group-promo .input-group-text,.input-group-promo .form-control,.input-group-promo .clear-input-btn{height:46px!important}.input-group-promo .input-group-text{display:flex;align-items:center;padding:.8rem 1rem;font-weight:600;color:#E0E0E0;background-color:#424242;border:1px solid #555;border-radius:12px 0 0 12px;border-right:0}.input-group-promo .form-control{border-radius:0 12px 12px 0!important;flex:1 1 auto;width:1%;min-width:0;position:static;top:auto}.clear-input-btn{position:absolute;right:10px;top:0;font-size:1.5rem;color:#999;cursor:pointer;display:none;line-height:46px;padding:0 5px}.clear-input-btn:hover{color:#ccc}.selected-promo-info{color:#FFF;background-color:#2d2d2d;padding:8px 12px;border-radius:8px;margin-top:10px;font-size:.85rem;font-weight:500;display:none;line-height:1.6;border-left:4px solid #FDB813}.unique-code-info{display:none;margin-top:10px;padding:10px 12px;background-color:#333;border-radius:8px;font-size:.9rem;color:#E0E0E0}.unique-code-info strong[style*="#d9534f"]{color:#ff8a80!important}.unique-code-info strong[style*="#00a2b1"]{color:#FDB813!important}.ewallet-form-container .ewallet-button{background-color:#FDB813;width:100%;margin:0;display:block}.ewallet-form-container .ewallet-button:hover{background-color:#EAA500}.cepat-button{width:100%;padding:14px;border:none;border-radius:12px;color:#000;font-size:1rem;font-weight:700;cursor:pointer;margin-top:24px;background-color:#FDB813;transition:background-color .2s;display:flex;align-items:center;justify-content:center;gap:8px}.result-container,.expired-container,.success-container{display:flex;flex-direction:column;align-items:center;text-align:center;padding:20px}.barcode-display{padding:15px;border:1px solid #444;border-radius:10px;margin:10px auto;width:100%;max-width:485px;display:block;background-color:#fff}.barcode-display canvas,.barcode-display img{width:100%!important;height:auto!important}#ewallet-barcode-container{padding:15px;border:1px solid #eee;border-radius:10px;margin-bottom:20px;min-height:100px;display:flex;align-items:center;justify-content:center;background-color:#fff}#ewallet-barcode-container{max-width:auto;margin:0 auto 20px auto}.final-amount{font-size:2rem;color:#FDB813;font-weight:700;display:block;margin:5px 0}.timer-container,.merchant-info{font-size:1rem;color:#BDBDBD;margin-bottom:10px}.merchant-info{display:flex!important;align-items:center;justify-content:center;gap:8px;font-size:.9rem;color:#BDBDBD}.payment-timer{font-weight:700;color:#ff8a80}.expired-container{padding:40px 20px;background-color:#442020;border:2px solid #d9534f;border-radius:10px;color:#fff}.buat-ulang-btn,.download-btn{background-color:#555;color:#fff;padding:10px 15px;border:none;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:8px;margin-top:10px}.success-container{padding:40px 0;background-color:#fff0;border-radius:15px;opacity:0;transition:opacity .5s ease;margin-top:20px;color:#fff}.success-container.visible{opacity:1}.success-container p{color:#BDBDBD;margin-top:8px}.svg-checkmark{width:80px;height:80px;border-radius:50%;display:block;stroke-width:3;stroke:#28a745;stroke-miterlimit:10;margin:0 auto 20px auto;box-shadow:inset 0 0 0 #28a45;animation:fill .4s ease-in-out .4s forwards,scale .3s ease-in-out .9s both}.svg-checkmark__circle{stroke-dasharray:166;stroke-dashoffset:166;stroke-width:3;stroke-miterlimit:10;stroke:#28a745;fill:none;animation:stroke .6s cubic-bezier(.65,0,.45,1) forwards}.svg-checkmark__check{transform-origin:50% 50%;stroke-dasharray:48;stroke-dashoffset:48;stroke:#fff;animation:stroke .3s cubic-bezier(.65,0,.45,1) .8s forwards}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideIn{from{transform:translateY(-50px)}to{transform:translateY(0)}}@keyframes blinkPromo{from{opacity:1;transform:scale(1)}to{opacity:.6;transform:scale(.9)}}@keyframes blink-animation{0%,100%{transform:scale(1);opacity:1}30%{transform:scale(.9);opacity:.6}60%{transform:scale(1.15);opacity:1}}@keyframes stroke{100%{stroke-dashoffset:0}}@keyframes scale{0%,100%{transform:none}50%{transform:scale3d(1.1,1.1,1)}}@keyframes fill{100%{box-shadow:inset 0 0 0 40px #28a745}}@keyframes shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}@media (max-width:768px){.qris-cepat-wrapper-v11 .cepat-form-container{padding:15px}.qris-cepat-wrapper-v11 .tab{font-size:.8rem;padding:8px 5px;gap:4px}.payment-method-box{padding:1px}.payment-method-box img,.payment-method-box svg{max-height:55px}.qris-cepat-wrapper-v11 label{font-size:.85rem;margin-bottom:.5rem}.qris-cepat-wrapper-v11 .form-control{height:42px!important;font-size:.9rem}.input-group-promo .input-group-text,.input-group-promo .clear-input-btn{height:42px!important}.quick-amount-btn{padding:8px 12px;font-size:.8rem}.cepat-button{padding:12px;font-size:.95rem}.final-amount{font-size:1.8rem}.expired-container,.success-container{padding:25px 15px}.expired-container h3,.success-container h3{font-size:1.2rem}.success-container p{font-size:.9rem}.svg-checkmark{width:60px;height:60px}.qris-form-container .input-group-promo .form-control,.ewallet-form-container .input-group-promo .form-control{position:relative}}
`;
$('head').append(`<style>${cS}</style>`);const quickAmountButtonsHTML=`<button type="button" class="quick-amount-btn" data-amount="25000">25rb</button><button type="button" class="quick-amount-btn" data-amount="50000">50rb</button><button type="button" class="quick-amount-btn" data-amount="75000">75rb</button><button type="button" class="quick-amount-btn" data-amount="100000">100rb</button><button type="button" class="quick-amount-btn" data-amount="200000">200rb</button><button type="button" class="quick-amount-btn" data-amount="250000">250rb</button><button type="button" class="quick-amount-btn" data-amount="500000">500rb</button><button type="button" class="quick-amount-btn" data-amount="1000000">1jt</button><button type="button" class="quick-amount-btn" data-amount="2000000">2jt</button><button type="button" class="quick-amount-btn" data-amount="3000000">3jt</button><button type="button" class="quick-amount-btn" data-amount="4000000">4jt</button><button type="button" class="quick-amount-btn" data-amount="5000000">5jt</button><button type="button" class="quick-amount-btn" data-amount="6000000">6jt</button><button type="button" class="quick-amount-btn" data-amount="7000000">7jt</button><button type="button" class="quick-amount-btn" data-amount="8000000">8jt</button><button type="button" class="quick-amount-btn" data-amount="9000000">9jt</button><button type="button" class="quick-amount-btn" data-amount="10000000">10jt</button>`;const hM=`
<div class="qris-cepat-wrapper-v11"><div class="depo-tabs"><button type="button" class="tab" data-target="manual"><i class="fa-solid fa-pen-to-square"></i>Manual</button><button type="button" class="tab" data-target="qris"><i class="fa-solid fa-qrcode"></i> QRIS</button><button type="button" class="tab" data-target="ewallet"><i class="fa-solid fa-wallet"></i> QRIS 2</button></div><div class="cepat-form-container qris-form-container"><div class="cepat-input-area"><div class="form-group"><div class="payment-method-box"><img src="https://dopminer.com/Gambar/qris_putih-3452668070.png" alt="QRIS Logo"></div></div><div class="form-group"><label>Pilih Nominal Cepat</label><div class="quick-amount-selector">${quickAmountButtonsHTML}</div></div><div class="form-group"><label for="qris-amount">Atau, Masukkan Jumlah Lain</label><div class="input-group-promo"><span class="input-group-text">Rp</span><input type="text" id="qris-amount" class="form-control" data-type="qris" placeholder="Contoh: 50.000"><span class="clear-input-btn">&times;</span></div><div class="unique-code-info"></div><div class="qris-validation-message"></div></div><div class="form-group promo-dropdown-container"><label for="promo-select">Promosi</label><select id="promo-select" class="form-control"><option value="">Memuat promosi...</option></select><div class="selected-promo-info"></div></div><button type="button" class="cepat-button qris-button"><span class="btn-text"><i class="fa-solid fa-qrcode"></i> Buat Kode QRIS</span></button></div><div class="result-container"></div></div><div class="cepat-form-container ewallet-form-container"><div class="cepat-input-area"><div class="form-group"><label>Silakan Transfer ke QRIS Berikut</label><div id="ewallet-barcode-container"><i class="fa-solid fa-spinner fa-spin"></i>&nbsp; Memuat barcode... </div></div><div class="form-group"><label for="ewallet-amount">Nominal Yang Ditransfer</label><div class="input-group-promo"><span class="input-group-text">Rp</span><input type="text" id="ewallet-amount" class="form-control" placeholder="Contoh: 50.000"></div></div><div class="form-group"><label for="ewallet-proof">Upload Bukti Transfer (Wajib)</label><input type="file" id="ewallet-proof" class="form-control" accept="image/png, image/jpeg, image/jpg" name="receipt"></div><div class="qris-validation-message" id="ewallet-validation-message"></div><button type="button" class="cepat-button ewallet-button"><span class="btn-text"><i class="fa-solid fa-paper-plane"></i> Kirim Deposit</span></button></div><div class="result-container"></div></div></div>
`;
const dF=$('form[action="/ajax/cm/reqDeposit"]');
function loadPromotions(formContext){const promoSelect=formContext.find('#promo-select');const promoContainer=formContext.find('.promo-dropdown-container');const bankId='10165:109';promoContainer.show();$.ajax({url:'/ajax/credit/getDepositPromotion',type:'GET',dataType:'json',data:{bankId:bankId},success:function(response){promoSelect.empty();if(response&&response[0]==='success'&&response[1].length>0){promoSelect.prop('disabled',false);promoSelect.append('<option value="">-- Pilih Promosi --</option>');response[1].forEach(p=>{const promoId=p[0];const promoName=p[1];const optionHtml=`<option value="${promoId}">${promoName}</option>`;promoSelect.append(optionHtml)})}else{promoSelect.prop('disabled',true);promoSelect.append('<option value="">Tidak ada promosi yang tersedia</option>')}},error:function(){promoSelect.empty();promoSelect.prop('disabled',true);promoSelect.append('<option value="">Gagal memuat promosi</option>')}})};
dF.each(function(){const cF=$(this);if(cF.find('.qris-cepat-wrapper-v11').length===0){const mFC=cF.children().wrapAll('<div class="manual-form-container-v11"></div>').parent();cF.prepend(hM);mFC.show();cF.find('.tab[data-target=manual]').addClass('active');loadPromotions(cF)}});
const sDS=(w,dA)=>{if(bC)clearInterval(bC);if(qT)clearInterval(qT);$.post('/ajax/cma2/allGameWalletRefresh');$.get('/ajax/account/getAccountDto',function(r){if(r&&typeof r[2]==='number'){$('.g8-bal-total').text('IDR '+r[2].toLocaleString('id-ID'))}});let aFS=0;const aQD=sessionStorage.getItem('activeQrData');const aDD=sessionStorage.getItem('activeDanaData');if(aQD){aFS=JSON.parse(aQD).amount}else if(aDD){aFS=JSON.parse(aDD).amount}
sessionStorage.removeItem('activeQrData');sessionStorage.removeItem('activeDanaData');const rC=w.find('.result-container');const fA=aFS.toLocaleString('id-ID');const sH=`<div class="success-container"><svg class="svg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="svg-checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="svg-checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg><h3>Deposit Berhasil!</h3><p>Saldo sebesar <strong>Rp ${fA}</strong> telah ditambahkan ke akun anda.</p></div>`;rC.html(sH).show();w.find('.cepat-input-area').hide();setTimeout(()=>{const sC=rC.find('.success-container');if(sC.length){sC.addClass('visible')}},10)};const sBC=(iB,w)=>{if(bC)clearInterval(bC);bC=setInterval(()=>{$.get('/ajax/account/getAccountDto',function(r){if(r&&typeof r[2]==='number'){const cB=r[2];if(cB>iB){sDS(w,cB)}}}).fail(()=>{console.error("Gagal memeriksa saldo akun.")})},5000)};const sQT=(eT,w)=>{if(qT)clearInterval(qT);const tD=w.find('.payment-timer');qT=setInterval(()=>{const tLS=Math.round((eT-Date.now())/1000);if(tLS<0){clearInterval(qT);sQE(w);return}
const m=Math.floor(tLS/60);let s=tLS%60;s=s<10?'0'+s:s;tD.text(`${m}:${s}`)},1000)};const sQE=(w)=>{if(bC)clearInterval(bC);sessionStorage.removeItem('activeQrData');sessionStorage.removeItem('activeDanaData');const eH=`<div class="expired-container"><h3>Waktu Pembayaran Habis!</h3><button type="button" class="buat-ulang-btn"><i class="fa-solid fa-rotate-right"></i> Buat Deposit Baru</button></div>`;w.find('.result-container').html(eH).show()};const dGQ=(d,w)=>{const{amount:a,expireTime:e,qrisString:q,initialBalance:i}=d;const mN=parseQrisMerchantName(q);const qP=generateQrisPayload(q,a.toString());const rH=`<div class="timer-container">Waktu Habis Dalam: <span class="payment-timer">-</span></div><div class="merchant-info"><i class="fa-solid fa-store"></i> Merchant: <strong class="merchant-name">${mN||'Tidak Dikenali'}</strong></div><div class="barcode-display"></div><strong class="final-amount">Rp ${a.toLocaleString('id-ID')}</strong><a href="#" class="download-btn"><i class="fa-solid fa-download"></i> Download QR</a>`;const rC=w.find('.result-container');rC.html(rH);const bD=rC.find('.barcode-display');new QRCode(bD[0],{text:qP,width:485,height:485,correctLevel:QRCode.CorrectLevel.Q});w.find('.cepat-input-area').hide();rC.show();sQT(e,w);sBC(i,w)};const getAccountData=(callback)=>{if(accountData){callback(accountData);return}
$.get('/ajax/account/getAccountDto',function(r){if(r&&typeof r[4]==='string'&&r[4].length>=3){accountData=r;callback(r)}else{callback(null)}}).fail(()=>{callback(null)})};
$('body').on('change','#promo-select',function(){const selectedPromoId=$(this).val();const selectedPromoName=$(this).find('option:selected').text();const amountInput=$(this).closest('.qris-form-container').find('#qris-amount');const promoInfoDiv=$(this).siblings('.selected-promo-info');amountInput.data('promo-id','').data('min-deposit','');promoInfoDiv.hide().html('');if(selectedPromoId){promoInfoDiv.html('<i class="fa-solid fa-spinner fa-spin"></i> Memeriksa info...').show();$.ajax({url:'/ajax/deposit/getPromotionInfo',type:'GET',data:{id:selectedPromoId},dataType:'json',success:function(r){if(r&&r.code==='200'){const{minDepositAmount:minDeposit,turnoverCondition:to,maxBonusAmount:maxBonusRaw}=r;const maxBonus=parseFloat(maxBonusRaw)*1000;amountInput.data('promo-id',selectedPromoId).data('min-deposit',minDeposit);promoInfoDiv.html(`Min. Depo: <strong>${parseFloat(minDeposit).toLocaleString('id-ID')}</strong> | TO: <strong>x${to}</strong> | Max Bonus: <strong>${maxBonus.toLocaleString('id-ID')}</strong>`).show()}else{promoInfoDiv.text('Gagal memuat detail promo.').show()}},error:function(){promoInfoDiv.text('Error saat mengambil info promo.').show()}})}});
$('body').on('click','.qris-cepat-wrapper-v11 .tab',function(){const cT=$(this);const t=cT.data('target');const w=cT.closest('.qris-cepat-wrapper-v11');if(cT.hasClass('active'))return;w.find('.tab').removeClass('active');cT.addClass('active');const pF=cT.closest('form');const manualForm=pF.find('.manual-form-container-v11');const qrisForm=w.find('.qris-form-container');const ewalletForm=w.find('.ewallet-form-container');manualForm.hide();qrisForm.hide();ewalletForm.hide();if(t==='manual'){manualForm.show()}else if(t==='qris'){qrisForm.show();const aQD=sessionStorage.getItem('activeQrData');if(aQD&&Date.now()<JSON.parse(aQD).expireTime){const qD=JSON.parse(aQD);if(qD.qrisString&&typeof qD.initialBalance==='number'){dGQ(qD,qrisForm)}}else{sessionStorage.removeItem('activeQrData');qrisForm.find('.cepat-input-area').show();qrisForm.find('.result-container').empty()}}else if(t==='ewallet'){ewalletForm.show();const barcodeContainer=w.find('#ewallet-barcode-container');if(barcodeContainer.find('img').length===0){barcodeContainer.html('<i class="fa-solid fa-spinner fa-spin"></i>&nbsp; Memuat barcode...');$.ajax({url:'https://lg9qr.jasjusweb.workers.dev/api/barcode',type:'GET',dataType:'json',success:function(response){if(response.success&&response.attachId){const imageUrl=`/stream/id?attachId=${response.attachId}`;barcodeContainer.html(`<img src="${imageUrl}" alt="QRIS 2 Barcode" style="max-width:80%; height:auto;">`)}else{barcodeContainer.html('<span style="color:red;">Gagal memuat barcode.</span>')}},error:function(){barcodeContainer.html('<span style="color:red;">Gagal memuat barcode. Silakan coba lagi.</span>')}})}}});
$('body').on('click','.quick-amount-btn',function(){const cB=$(this);const iA=cB.closest('.cepat-input-area');const amountInput=iA.find('#qris-amount');amountInput.data('unique-code','');amountInput.val(parseInt(cB.data('amount'))).trigger('input').removeClass('is-invalid');iA.find('.qris-validation-message').hide()});
$('body').on('input','.form-control[data-type], #ewallet-amount',function(event){const input=$(this);const formGroup=input.closest('.form-group');const infoDiv=formGroup.find('.unique-code-info');const clearBtn=formGroup.find('.clear-input-btn');const type=input.data('type');input.removeClass('is-invalid');formGroup.find('.qris-validation-message').hide();let rawValue=input.val().replace(/[^\d]/g,'');if(rawValue&&parseInt(rawValue,10)>10000000){rawValue='10000000'}
const nominal=parseInt(rawValue,10)||0;input.closest('.cepat-input-area').find('.quick-amount-btn').each(function(){const btn=$(this);if(parseInt(btn.data('amount'),10)===nominal){btn.addClass('active')}else{btn.removeClass('active')}});input.val(rawValue?nominal.toLocaleString('id-ID'):'');if(nominal>0){if(type==='qris'){if(nominal===10000000){let uniqueCode=0;input.data('unique-code',uniqueCode);const totalAmount=nominal;infoDiv.html(`Total Transfer: <strong style="color: #FDB813;">Rp ${totalAmount.toLocaleString('id-ID')}</strong>`).show()}else{let uniqueCode=input.data('unique-code');if(!uniqueCode||uniqueCode===0){uniqueCode=Math.floor(Math.random()*90)+10;input.data('unique-code',uniqueCode)}
const totalAmount=nominal+uniqueCode;infoDiv.html(`Kode Unik: <strong style="color: #ff8a80;">${uniqueCode}</strong> &bull; Total Transfer: <strong style="color: #FDB813;">Rp ${totalAmount.toLocaleString('id-ID')}</strong>`).show()}}}else{infoDiv.hide();input.data('unique-code','')}
if(input.val().length>0){if(clearBtn.is(":visible")){clearBtn.show()}}else{if(clearBtn.is(":visible")){clearBtn.hide()}}});$('body').on('click','.clear-input-btn',function(){const nominalInput=$(this).siblings('.form-control');nominalInput.val('');nominalInput.trigger('input');$(this).hide()});

$('body').on('click','.qris-button',async function(){const gB=$(this);const w=gB.closest('.cepat-form-container');const aI=w.find('input[data-type="qris"]');const vM=aI.closest('.form-group').find('.qris-validation-message');const btnTextDefault='<span class="btn-text"><i class="fa-solid fa-qrcode"></i> Buat Kode QRIS</span>';aI.removeClass('is-invalid');vM.hide();let aV=aI.val().replace(/[^\d]/g,'');if(!aV||parseInt(aV,10)===0){aI.addClass('is-invalid');vM.text("Silakan isi nominal terlebih dahulu.").show();return}
const pA=parseInt(aV,10),pId=w.find('#promo-select').val()||"",mDP=aI.data('min-deposit');if(pId&&mDP){if(pA<mDP){aI.addClass('is-invalid');vM.text(`Minimal deposit untuk promo ini adalah Rp ${parseInt(mDP).toLocaleString('id-ID')}.`).show();return}}else{if(pA<25000){aI.addClass('is-invalid');vM.text("Minimal deposit adalah Rp 25.000.").show();return}}
if(pA>10000000){aI.addClass('is-invalid');vM.text("Maksimal deposit adalah Rp 10.000.000.").show();return}
const uniqueCode=aI.data('unique-code');if(typeof uniqueCode==='undefined'||uniqueCode===''){vM.text("Gagal mendapatkan kode unik. Silakan coba ketik ulang nominal.").show();return}
gB.prop('disabled',!0).html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Memproses...</span>');try{const aD=await $.get('/ajax/account/getAccountDto');if(!aD||typeof aD[2]!=='number'){throw new Error('Gagal mendapatkan informasi saldo saat ini.')}
const iB=aD[2];const qCR=await fetch('https://lg9qr.jasjusweb.workers.dev/api/config');if(!qCR.ok){throw new Error('Network response was not ok')}
const qC=await qCR.json();if(qC.maintenanceMode||!qC.qrisString){throw new Error("Sistem pembayaran tidak tersedia.")}
const aWUC=pA+parseInt(uniqueCode,10);const bI='10165:109';const tR='QRIS CEPAT';const tRI=gB.closest('form').find('input[name="telcoRemark"]');tRI.val(tR);const dD={amount:aWUC,bankId:bI,promotionId:pId,telcoRemark:tR};$.ajax({type:'POST',url:'/ajax/cm/reqDeposit',data:dD,success:function(r){if(r&&Array.isArray(r)&&r[0]==='error.ex'){const eM=r[1]||"";let uM;if(eM.includes("Maximum 1 pending deposit request confirmation")){uM="Hanya boleh ada 1 permintaan deposit yang pending."}else if(eM.includes("tunggu beberapa saat untuk deposit kembali")){uM="Tunggu sebentar sebelum mencoba deposit kembali."}else if(eM.includes("mengambil promo bonus")){uM="Deposit gagal karena promo bonus masih aktif. Silakan hubungi CS untuk bantuan."}else{uM=eM||"Terjadi kesalahan yang tidak diketahui."}
vM.text('Gagal: '+uM).show()}else{const qrData={amount:aWUC,expireTime:Date.now()+300*1000,qrisString:qC.qrisString,initialBalance:iB};const sessionKey='activeQrData';sessionStorage.setItem(sessionKey,JSON.stringify(qrData));dGQ(qrData,w)}},error:function(){vM.text('Gagal: Terjadi kesalahan koneksi. Silakan coba lagi.').show()},complete:function(){gB.prop('disabled',!1).html(btnTextDefault)}})}catch(e){vM.text('Gagal: '+e.message).show();gB.prop('disabled',!1).html(btnTextDefault)}})
$('body').on('click','.ewallet-button',async function(){const btn=$(this);const w=btn.closest('.ewallet-form-container');const amountInput=w.find('#ewallet-amount');const proofInput=w.find('#ewallet-proof');const validationMessage=w.find('#ewallet-validation-message');const btnTextDefault='<span class="btn-text"><i class="fa-solid fa-paper-plane"></i> Kirim</span>';validationMessage.hide();amountInput.removeClass('is-invalid');proofInput.removeClass('is-invalid');const amountValue=amountInput.val().replace(/[^\d]/g,'');let proofFile=proofInput[0].files[0];if(!amountValue||parseInt(amountValue,10)<=0){validationMessage.text('Silakan isi nominal yang valid.').show();amountInput.addClass('is-invalid');return}
if(parseInt(amountValue,10)<25000){validationMessage.text('Minimal deposit adalah Rp 25.000.').show();amountInput.addClass('is-invalid');return}
if(!proofFile){validationMessage.text('Silakan upload bukti transfer.').show();proofInput.addClass('is-invalid');return}
btn.prop('disabled',!0);if(proofFile.size>1*1024*1024){try{btn.html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Mengompres gambar...</span>');proofFile=await compressImage(proofFile)}catch(error){validationMessage.text('Gagal memproses gambar. Coba file lain.').show();btn.prop('disabled',!1).html(btnTextDefault);return}}
btn.html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Mengupload...</span>');const uploadFormData=new FormData();uploadFormData.append('receipt',proofFile,'compressed-proof.jpg');$.ajax({url:'/upload/id?attachType=7',type:'POST',data:uploadFormData,processData:!1,contentType:!1,success:function(uploadResponse){btn.html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Mengonfirmasi...</span>');const depositData={bankId:'10165:109',amount:amountValue,telcoRemark:'QRIS MANUAL',promotionId:''};$.ajax({url:'/ajax/cm/reqDeposit',type:'POST',data:depositData,success:function(depositResponse){if(depositResponse&&Array.isArray(depositResponse)&&depositResponse[0]==='error.ex'){const eM=depositResponse[1]||"";let uM;if(eM.includes("Maximum 1 pending deposit request confirmation")){uM="Hanya boleh ada 1 permintaan deposit yang pending."}else if(eM.includes("tunggu beberapa saat untuk deposit kembali")){uM="Tunggu sebentar sebelum mencoba deposit kembali."}else if(eM.includes("mengambil promo bonus")){uM="Deposit gagal karena promo bonus masih aktif. Silakan hubungi CS untuk bantuan."}else{uM=eM||"Terjadi kesalahan yang tidak diketahui."}
validationMessage.text('Gagal: '+uM).show();btn.prop('disabled',!1).html(btnTextDefault)}else{w.find('.cepat-input-area').hide();const successHTML=`<div class="success-container visible">
<svg class="svg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="svg-checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="svg-checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>
<h3>Deposit Terkirim!</h3>
<p>Konfirmasi deposit Anda telah berhasil dan akan segera kami proses.</p>
</div>`;w.find('.result-container').html(successHTML)}},error:function(){validationMessage.text('Gagal konfirmasi deposit. Silakan hubungi CS.').show();btn.prop('disabled',!1).html(btnTextDefault)}})},error:function(){validationMessage.text('Gagal mengupload bukti transfer. Periksa koneksi Anda.').show();btn.prop('disabled',!1).html(btnTextDefault)}})});$('body').on('click','.buat-ulang-btn',function(){if(qT)clearInterval(qT);if(bC)clearInterval(bC);sessionStorage.removeItem('activeQrData');sessionStorage.removeItem('activeDanaData');const w=$(this).closest('.cepat-form-container');w.find('.result-container').empty();w.find('.cepat-input-area').show()});$('body').on('click','.download-btn',function(e){e.preventDefault();const w=$(this).closest('.result-container'),c=w.find('.barcode-display canvas')[0],a=w.find('.final-amount').text().replace(/[^0-9]/g,'');if(c){const p=30,n=document.createElement('canvas');n.width=c.width+p;n.height=c.height+p;const x=n.getContext('2d');x.fillStyle='#FFFFFF';x.fillRect(0,0,n.width,n.height);x.drawImage(c,p/2,p/2);const l=document.createElement('a');l.href=n.toDataURL("image/png");l.download=`QRIS-Payment-${a}.png`;l.click()}});const cAQL=()=>{const aQD=sessionStorage.getItem('activeQrData');const qW=$('.qris-form-container:visible');if(qW.length>0&&aQD&&Date.now()<JSON.parse(aQD).expireTime){const qD=JSON.parse(aQD);if(qD.qrisString&&typeof qD.initialBalance==='number'){qW.closest('.qris-cepat-wrapper-v11').find('.tab[data-target="qris"]').trigger('click')}}};setTimeout(cAQL,500)})
